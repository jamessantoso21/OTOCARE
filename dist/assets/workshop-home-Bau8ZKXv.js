import{j as e,a as O,d as m}from"./index-7S1YI_WY.js";import{r as a,L as d}from"./vendor-react-D2XI2PP0.js";import{N as v,F as y}from"./Footer-BkaXL5t4.js";import{d as D,b as C,h as H,q as S,w as c,o as E,j as M}from"./vendor-firebase-CAApZDyK.js";const R=()=>e.jsx("div",{className:"Map",children:e.jsx("iframe",{src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d247.9342762236869!2d106.8695277699229!3d-6.137632473302848!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e69f57eecd18327%3A0xbb98a90ffb91397d!2sCity%20Motor!5e0!3m2!1sen!2sid!4v1731845846629!5m2!1sen!2sid",width:"100%",height:"300",style:{border:10},allowFullScreen:"",loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Google Maps Embed"})});function W(){const[u,p]=a.useState(0),[x,f]=a.useState(0),[F,w]=a.useState(null),[l,j]=a.useState(null);a.useEffect(()=>{const n=O.onAuthStateChanged(async r=>{if(w(r),r)try{const s=D(m,"Users",r.uid),o=await C(s);if(o.exists()){const t=o.data();j(t.UserName),N(t.UserName)}else console.error("No user document found for UID:",r.uid)}catch(s){console.error("Error fetching user data:",s)}});return()=>n()},[]);const N=async n=>{try{const r=new Date,s=new Date(r),o=new Date(r.getFullYear(),r.getMonth()-1);console.log("Fetching stats for orders between:",s,"and",o);const t=H(m,"Orders"),b=S(t,c("orderShop","==",n),c("orderDate",">=",o),c("orderDate","<",s),E("orderDate","desc")),g=await M(b);let h=0,i=0;g.forEach(k=>{h++,i+=k.data().orderPrice||0}),p(h),f(i)}catch(r){console.error("Error fetching order stats:",r)}};return e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsxs("div",{className:"homeContainer",children:[e.jsxs("div",{className:"titleContainer",children:[e.jsxs("h1",{className:"workshopHome-header",children:["Hi, ",l?`${l}'s workshop`:"Workshop","!"]}),e.jsx("h1",{className:"workshopHome-header",children:"Welcome back to your dashboard"})]}),e.jsxs("div",{className:"mapContainer",children:[e.jsx("h1",{className:"workshopHome-header",children:"Emergency Order"}),e.jsx(R,{}),e.jsx(d,{to:"/workshopConfirmation",className:"getOrder-btn",children:"Get Order"})]}),e.jsxs("div",{className:"dashboardContainer",children:[e.jsxs("div",{className:"dashboard-top",children:[e.jsx("h1",{className:"workshopHome-header",children:"Total Orders This Month"}),e.jsx("p",{className:"workshopHome-text",children:u})]}),e.jsxs("div",{className:"dashboard-bot",children:[e.jsx("h1",{className:"workshopHome-header",children:"Total Revenue This Month"}),e.jsxs("p",{className:"workshopHome-text",children:["Rp ",x.toLocaleString()]}),e.jsx(d,{to:"/workshopOrder",className:"viewOrder-btn",children:"View Orders"})]})]}),e.jsxs("div",{className:"manualOrder",children:[e.jsx("h1",{className:"workshopHome-header",children:"Add Manual Order"}),e.jsx(d,{to:"/workshopForm",className:"manualOrder-btn",children:"Add Order"})]})]}),e.jsx(y,{})]})}export{W as default};
